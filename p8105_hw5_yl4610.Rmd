---
title: "p8105_hw5_yl4610"
output: github_document
date: "2022-11-08"
---

```{r setup, message=FALSE}
library(tidyverse)
```

# problem 1 

# problem 2 
```{r, message=FALSE}
homicide_raw = read_csv( "./data/homicide_data.csv") 
```
This dataset contains variables such as `r names(homicide_raw)`. It contains `r ncol(homicide_raw)` columns and `r nrow(homicide_raw)` rows. 

```{r, results='hide'}
homicide = 
homicide_raw %>% 
  mutate (
    city_state = str_c(city, ", ", state),
    city_state = ifelse(city_state == "Tulsa, AL", "Tulsa, OK", city_state)) %>%
  group_by(city_state) %>% 
  summarize(
    total_homicides = n(),
    unsolved_homicides = sum(disposition !="Closed by arrest"))

homicide
```

I used mutate to create a city_state variable. Then I used group_by and summarize to summarize within cities to obtain the total number of homicides and the number of unsolved homicides.

```{r}
baltimore = 
  homicide %>% 
  filter(city_state == "Baltimore, MD") 

prop.test(
  baltimore$unsolved_homicides,baltimore$total_homicides) %>% 
  broom::tidy()
```
I used filter to filter out other city_state except "Baltimore, MD". Then I used prop.test function to estimate the proportion of homicides that are unsolved and applied the broom::tidy to pull the estimated proportion and confidence intervals.

```{r}
city_final = 
  homicide %>% 
  mutate(
    outputs_df = map2 (unsolved_homicides,total_homicides, prop.test),
    final_outputs_df = map(outputs_df, broom::tidy)) %>% 
  unnest(final_outputs_df) %>% 
  arrange(desc(estimate)) %>% 
  select (city_state, estimate, conf.low, conf.high)

city_final
```
I used mutate to run prop.test for each of the cities and extract both the proportion of unsolved homicides and the confidence interval for each via purrr::map and purrr::map2. Then I unnested the final_outputs_df and selected variables I wanted to create a tidy dataframe with estimated proportions and CIs for each city.

# problem 3